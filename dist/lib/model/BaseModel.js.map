{"version":3,"file":"BaseModel.js","sourceRoot":"","sources":["../../../src/lib/model/BaseModel.ts"],"names":[],"mappings":";;;;;;AAAA,iEAAmH;AACnH,wEAAgD;AAEhD,MAAM,yBAAyB,GAAG,EAAE,CAAC;AAErC,MAAsB,SAAS;IAEnB,KAAK,CAAC,YAAY;QAC1B,OAAO;YACL,SAAS,EAAE,MAAM,CAAC,MAAM,yBAAe,CAAC,WAAW,EAAE,CAAC,CAAC,YAAY,EAAE;SACtE,CAAC;IACJ,CAAC;IAES,KAAK,CAAC,iBAAiB,CAAC,QAAyB,EAAE,GAA0B;QACrF,MAAM,EAAE,SAAS,EAAE,GAAG,MAAM,IAAI,CAAC,YAAY,EAAE,CAAC;QAChD,MAAM,YAAY,GAAG,QAAQ,CAAC,aAAa,EAAE,OAAO,CAAC,mBAAO,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;QAChF,KAAK,MAAM,WAAW,IAAI,YAAY,EAAE,CAAC;YACvC,IAAI,uBAAuB,GAAG,WAAW,CAAC,YAAY,CAAC;YACvD,IAAI,WAAW,CAAC,iBAAiB,KAAK,MAAM,EAAE,CAAC;gBAC7C,uBAAuB,GAAG,SAAS,CAAC;YACtC,CAAC;YACD,IAAI,WAAW,GAAG,CAAC,CAAC;YACpB,OAAO,uBAAuB,IAAI,WAAW,GAAG,yBAAyB,EAAE,CAAC;gBAC1E,MAAM,QAAQ,GAAG,MAAM,SAAS,CAAC,OAAO,CAAC,OAAO,CAAC,GAAG,EAAE,EAAE,KAAK,EAAE,uBAAuB,EAAE,MAAM,EAAE,SAAS,EAAE,CAAC,CAAC;gBAC7G,MAAM,IAAI,GAAG,kBAAM,CAAC,aAAa,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;gBACjD,MAAM,EAAE,GAAG,IAAI,CAAC,qBAAqB,EAAE,WAAW,CAAC,mCAAuB,CAAC,CAAC;gBAC5E,IAAI,EAAE,IAAI,EAAE,CAAC,QAAQ,EAAE,CAAC;oBACtB,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,QAAQ,CAAC,CAAC;oBAC1C,uBAAuB,GAAG,EAAE,CAAC,YAAY,CAAC;oBAC1C,WAAW,EAAE,CAAC;gBAChB,CAAC;qBACI,CAAC;oBACJ,MAAM;gBACR,CAAC;YACH,CAAC;YACD,OAAO,WAAW,CAAC,YAAY,CAAC;QAClC,CAAC;IACH,CAAC;CACF;AAjCD,8BAiCC","sourcesContent":["import { type IParsedResponse, Parser, SectionListContinuation, YTNodes } from 'volumio-yt-support/dist/innertube';\nimport InnertubeLoader from './InnertubeLoader';\n\nconst MAX_APPEND_SECTIONS_COUNT = 10;\n\nexport abstract class BaseModel {\n\n  protected async getInnertube() {\n    return {\n      innertube: await (await InnertubeLoader.getInstance()).getInnertube()\n    };\n  }\n\n  protected async expandSectionList(response: IParsedResponse, url: '/browse' | '/search') {\n    const { innertube } = await this.getInnertube();\n    const sectionLists = response.contents_memo?.getType(YTNodes.SectionList) || [];\n    for (const sectionList of sectionLists) {\n      let sectionListContinuation = sectionList.continuation;\n      if (sectionList.continuation_type !== 'next') {\n        sectionListContinuation = undefined;\n      }\n      let appendCount = 0;\n      while (sectionListContinuation && appendCount < MAX_APPEND_SECTIONS_COUNT) {\n        const response = await innertube.actions.execute(url, { token: sectionListContinuation, client: 'YTMUSIC' });\n        const page = Parser.parseResponse(response.data);\n        const cc = page.continuation_contents?.firstOfType(SectionListContinuation);\n        if (cc && cc.contents) {\n          sectionList.contents.push(...cc.contents);\n          sectionListContinuation = cc.continuation;\n          appendCount++;\n        }\n        else {\n          break;\n        }\n      }\n      delete sectionList.continuation;\n    }\n  }\n}\n"]}