{"version":3,"file":"InnertubeLoader.js","sourceRoot":"","sources":["../../../src/lib/model/InnertubeLoader.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAAA,uEAAwC;AACxC,2DAA+F;AAE/F,MAAqB,eAAe;IAIlC,MAAM,CAAC,KAAK,CAAC,WAAW;QACtB,IAAI,CAAC,uBAAA,IAAI,4CAAiB,EAAE,CAAC;YAC3B,wBAAO,CAAC,KAAK,CAAC,MAAM,EAAE,wBAAO,CAAC,OAAO,CAAC,sBAAsB,CAAC,CAAC,CAAC;YAC/D,uBAAA,IAAI,MAAoB,qCAAgB,CAAC,kBAAkB,CAAC;gBAC1D,OAAO,EAAE;oBACP,MAAM,EAAE,wBAAO,CAAC,cAAc,CAAC,QAAQ,CAAC,IAAI,SAAS;oBACrD,mBAAmB,EAAE,wBAAO,CAAC,cAAc,CAAC,qBAAqB,CAAC;iBACnE;gBACD,MAAM,EAAE;oBACN,MAAM,EAAE,wBAAO,CAAC,cAAc,CAAC,QAAQ,CAAC;oBACxC,QAAQ,EAAE,wBAAO,CAAC,cAAc,CAAC,UAAU,CAAC;iBAC7C;gBACD,MAAM,EAAE;oBACN,IAAI,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,wBAAO,CAAC,SAAS,EAAE,CAAC,IAAI,CAAC,aAAa,GAAG,EAAE,CAAC;oBAC3D,IAAI,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,wBAAO,CAAC,SAAS,EAAE,CAAC,IAAI,CAAC,aAAa,GAAG,EAAE,CAAC;oBAC3D,KAAK,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,wBAAO,CAAC,SAAS,EAAE,CAAC,KAAK,CAAC,aAAa,GAAG,EAAE,CAAC;iBAC9D;aACF,CAAC,wCAAA,CAAC;QACL,CAAC;QACD,OAAO,uBAAA,IAAI,4CAAiB,CAAC;IAC/B,CAAC;IAED,MAAM,CAAC,KAAK,CAAC,eAAe,CAAC,UAAkB;QAC7C,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,WAAW,EAAE,CAAC;QAC1C,OAAO,MAAM,QAAQ,CAAC,eAAe,CAAC,UAAU,CAAC,CAAC;IACpD,CAAC;IAED,MAAM,CAAC,KAAK,CAAC,KAAK;QAChB,IAAI,uBAAA,IAAI,4CAAiB,EAAE,CAAC;YAC1B,MAAM,QAAQ,GAAG,MAAM,uBAAA,IAAI,4CAAiB,CAAC;YAC7C,MAAM,QAAQ,CAAC,OAAO,EAAE,CAAC;YACzB,uBAAA,IAAI,MAAoB,IAAI,wCAAA,CAAC;QAC/B,CAAC;IACH,CAAC;IAED,MAAM,CAAC,KAAK,CAAC,eAAe;QAC1B,MAAM,MAAM,GAAG,wBAAO,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;QAChD,MAAM,QAAQ,GAAG,wBAAO,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC;QACpD,IAAI,uBAAA,IAAI,4CAAiB,EAAE,CAAC;YAC1B,MAAM,QAAQ,GAAG,MAAM,uBAAA,IAAI,4CAAiB,CAAC;YAC7C,QAAQ,CAAC,SAAS,CAAC,EAAE,MAAM,EAAE,QAAQ,EAAE,CAAC,CAAC;QAC3C,CAAC;IACH,CAAC;;;AA5CM,4CAAqD,IAAI,EAAzC,CAA0C;kBAF9C,eAAe","sourcesContent":["import ytmusic from '../YTMusicContext';\nimport { InnertubeFactory, type InnertubeWrapper, type PotFnResult } from 'volumio-yt-support';\n\nexport default class InnertubeLoader {\n\n  static #instancePromise: Promise<InnertubeWrapper> | null = null;\n\n  static async getInstance(): Promise<InnertubeWrapper> {\n    if (!this.#instancePromise) {\n      ytmusic.toast('info', ytmusic.getI18n('YTMUSIC_PREPPING_API'));\n      this.#instancePromise = InnertubeFactory.getWrappedInstance({\n        account: {\n          cookie: ytmusic.getConfigValue('cookie') || undefined,\n          activeChannelHandle: ytmusic.getConfigValue('activeChannelHandle')\n        },\n        locale: {\n          region: ytmusic.getConfigValue('region'),\n          language: ytmusic.getConfigValue('language')\n        },\n        logger: {\n          info: (msg) => ytmusic.getLogger().info(`[ytmusic] ${msg}`),\n          warn: (msg) => ytmusic.getLogger().warn(`[ytmusic] ${msg}`),\n          error: (msg) => ytmusic.getLogger().error(`[ytmusic] ${msg}`),\n        }\n      });\n    }\n    return this.#instancePromise;\n  }\n\n  static async generatePoToken(identifier: string): Promise<PotFnResult> {\n    const instance = await this.getInstance();\n    return await instance.generatePoToken(identifier);\n  }\n\n  static async reset() {\n    if (this.#instancePromise) {\n      const instance = await this.#instancePromise;\n      await instance.dispose();\n      this.#instancePromise = null;\n    }\n  }\n\n  static async applyI18nConfig() {\n    const region = ytmusic.getConfigValue('region');\n    const language = ytmusic.getConfigValue('language');\n    if (this.#instancePromise) {\n      const instance = await this.#instancePromise;\n      instance.setLocale({ region, language });\n    }\n  }\n}\n"]}