{"version":3,"file":"AccountModel.js","sourceRoot":"","sources":["../../../src/lib/model/AccountModel.ts"],"names":[],"mappings":";;;;;AACA,6DAA6D;AAE7D,2CAAwC;AACxC,oFAA4D;AAC5D,6DAA6D;AAE7D,MAAqB,YAAa,SAAQ,qBAAS;IAEjD,KAAK,CAAC,OAAO;QACX,MAAM,EAAE,SAAS,EAAE,GAAG,MAAM,IAAI,CAAC,YAAY,EAAE,CAAC;QAChD,MAAM,EAAE,UAAU,EAAE,QAAQ,EAAE,GAAG,MAAM,IAAA,0CAAqB,EAAC,SAAS,CAAC,CAAC;QAExE,IAAI,CAAC,UAAU,EAAE,CAAC;YAChB,OAAO;gBACL,UAAU,EAAE,KAAK;gBACjB,IAAI,EAAE,IAAI;aACX,CAAC;QACJ,CAAC;QAED,MAAM,IAAI,GAAG,IAAI,wBAAE,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;QAC1C,wFAAwF;QACxF,uDAAuD;QACvD,MAAM,OAAO,GAAG,IAAI,CAAC,QAAQ,EAAE,QAAQ,CAAC,IAAI,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,6BAAO,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC,WAAW,CAAC,CAAC;QAEnG,IAAI,OAAO,EAAE,EAAE,CAAC,6BAAO,CAAC,WAAW,CAAC,EAAE,CAAC;YACrC,MAAM,IAAI,GAAG,+BAAqB,CAAC,MAAM,CAAC,OAAO,EAAE,YAAY,CAAC,CAAC;YAEjE,IAAI,IAAI,EAAE,CAAC;gBACT,MAAM,MAAM,GAAyB;oBACnC,IAAI;oBACJ,KAAK,EAAE,+BAAqB,CAAC,cAAc,CAAC,OAAO,CAAC,aAAa,CAAC;iBACnE,CAAC;gBAEF,OAAO;oBACL,UAAU,EAAE,IAAI;oBAChB,IAAI,EAAE,MAAM;iBACb,CAAC;YACJ,CAAC;QACH,CAAC;QAED,MAAM,KAAK,CAAC,0CAA0C,CAAC,CAAA;IACzD,CAAC;CACF;AApCD,+BAoCC","sourcesContent":["import type Innertube from 'volumio-youtubei.js';\nimport { YTNodes, Endpoints, YT } from 'volumio-youtubei.js';\nimport { type PluginConfig } from '../types';\nimport { BaseModel } from './BaseModel';\nimport InnertubeResultParser from './InnertubeResultParser';\nimport { getAccountInitialInfo } from './AccountModelHelper';\n\nexport default class AccountModel extends BaseModel {\n\n  async getInfo() {\n    const { innertube } = await this.getInnertube();\n    const { isSignedIn, response } = await getAccountInitialInfo(innertube);\n\n    if (!isSignedIn) {\n      return {\n        isSignedIn: false,\n        info: null\n      };\n    }\n\n    const info = new YT.AccountInfo(response);   \n    // This plugin supports single sign-in, so there should only be one account in contents.\n    // But we still get the 'selected' one just to be sure.\n    const account = info.contents?.contents.find((ac) => ac.is(YTNodes.AccountItem) && ac.is_selected);\n\n    if (account?.is(YTNodes.AccountItem)) {\n      const name = InnertubeResultParser.unwrap(account?.account_name);\n\n      if (name) {\n        const result: PluginConfig.Account = {\n          name,\n          photo: InnertubeResultParser.parseThumbnail(account.account_photo)\n        };\n\n        return {\n          isSignedIn: true,\n          info: result\n        };\n      }\n    }\n\n    throw Error('Signed in but unable to get account info')\n  }\n}\n"]}